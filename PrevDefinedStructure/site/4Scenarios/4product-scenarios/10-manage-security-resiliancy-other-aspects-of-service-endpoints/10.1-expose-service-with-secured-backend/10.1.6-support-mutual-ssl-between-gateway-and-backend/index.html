



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="WSO2 API Manager">
      
      
      
        <meta name="author" content="WSO2, Inc.">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-3.1.0">
    
    
      
        <title>WSo2 API Manager 2.6.0</title>
      
    
    
      <link rel="stylesheet" href="../../../../../assets/stylesheets/application.11e41852.css">
      
      
    
    
      <script src="../../../../../assets/javascripts/modernizr.20ef595d.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../../../../assets/fonts/material-icons.css">
    
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#1016-supporting-mutual-ssl-between-api-gateway-and-backend" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../../../../.." title="WSo2 API Manager 2.6.0" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                WSo2 API Manager 2.6.0
              </span>
              <span class="md-header-nav__topic">
                10.1.6 Supporting mutual SSL between API Gateway and backend
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/shaniR/product-apim/tree/product-scenarios/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../../../../.." title="WSo2 API Manager 2.6.0" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    WSo2 API Manager 2.6.0
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/shaniR/product-apim/tree/product-scenarios/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../../../../1Introduction/Introduction/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../../../2QuickStartGuide/QuickStartGuide/" title="Quick Start Guide" class="md-nav__link">
      Quick Start Guide
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../../../3KeyConcepts/KeyConcepts/" title="Key Concepts" class="md-nav__link">
      Key Concepts
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Use Cases
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Use Cases
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-1" type="checkbox" id="nav-4-1">
    
    <label class="md-nav__link" for="nav-4-1">
      API Publisher
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-1">
        API Publisher
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-1-1" type="checkbox" id="nav-4-1-1">
    
    <label class="md-nav__link" for="nav-4-1-1">
      API Design
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-4-1-1">
        API Design
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-1-1-1" type="checkbox" id="nav-4-1-1-1">
    
    <label class="md-nav__link" for="nav-4-1-1-1">
      REST API
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="4">
      <label class="md-nav__title" for="nav-4-1-1-1">
        REST API
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../1-manage-public-partner-private-apis/1.1-expose-service-as-rest-api/1.1.1-create-rest-api-from-scratch/" title="Create and Publish a REST API" class="md-nav__link">
      Create and Publish a REST API
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../1-manage-public-partner-private-apis/1.1-expose-service-as-rest-api/1.1.2-create-rest-api-by-import-oas-document/" title="Create and Publish an API from a Swagger Definition" class="md-nav__link">
      Create and Publish an API from a Swagger Definition
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../.." title="SOAP API" class="md-nav__link">
      SOAP API
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../.." title="WEBSOCKET API" class="md-nav__link">
      WEBSOCKET API
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../.." title="API PROXY CREATION" class="md-nav__link">
      API PROXY CREATION
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../.." title="ENDPOINTS" class="md-nav__link">
      ENDPOINTS
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-1-2" type="checkbox" id="nav-4-1-2">
    
    <label class="md-nav__link" for="nav-4-1-2">
      API Versioning
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-4-1-2">
        API Versioning
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../.." title="Create Default Version" class="md-nav__link">
      Create Default Version
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../.." title="Create a New Version" class="md-nav__link">
      Create a New Version
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../.." title="API Gateway" class="md-nav__link">
      API Gateway
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../.." title="API Microgateway" class="md-nav__link">
      API Microgateway
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../.." title="Rate Limiting" class="md-nav__link">
      Rate Limiting
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../.." title="API Security" class="md-nav__link">
      API Security
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../.." title="Analytics" class="md-nav__link">
      Analytics
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../.." title="Administration" class="md-nav__link">
      Administration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../.." title="Extentions" class="md-nav__link">
      Extentions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../.." title="Reference" class="md-nav__link">
      Reference
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../../.." title="Business Use Cases" class="md-nav__link">
      Business Use Cases
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../../../5DeveloperGuide/DeveloperGuide/" title="Developer Guide" class="md-nav__link">
      Developer Guide
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../../../6DeploymentGuide/DeploymentGuide/" title="Deployment Guide" class="md-nav__link">
      Deployment Guide
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../../../7AdminGuide/AdminGuide/" title="Admin Guide" class="md-nav__link">
      Admin Guide
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../../../8Reference/Reference/" title="Reference" class="md-nav__link">
      Reference
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../../../9Troubleshooting/Troubleshooting/" title="Troubleshooting" class="md-nav__link">
      Troubleshooting
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#when-to-use-this-approach" title="When to use this approach" class="md-nav__link">
    When to use this approach
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sample-use-case" title="Sample use case" class="md-nav__link">
    Sample use case
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#supported-versions" title="Supported versions" class="md-nav__link">
    Supported versions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pre-requisites" title="Pre-requisites" class="md-nav__link">
    Pre-requisites
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#development-guidelines" title="Development guidelines" class="md-nav__link">
    Development guidelines
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sample-configuration" title="Sample Configuration" class="md-nav__link">
    Sample Configuration
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deployment-guidelines" title="Deployment guidelines" class="md-nav__link">
    Deployment guidelines
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rest-api-if-available" title="REST API (if available)" class="md-nav__link">
    REST API (if available)
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/shaniR/product-apim/tree/product-scenarios/product-scenarios/4Scenarios/4product-scenarios/10-manage-security-resiliancy-other-aspects-of-service-endpoints/10.1-expose-service-with-secured-backend/10.1.6-support-mutual-ssl-between-gateway-and-backend/README.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="1016-supporting-mutual-ssl-between-api-gateway-and-backend">10.1.6 Supporting mutual SSL between API Gateway and backend</h1>
<h2 id="when-to-use-this-approach">When to use this approach</h2>
<p>When an API Developer want to expose their backend using mutual SSL through API Publisher where the server validates the identity of the client so that both parties trust each other.</p>
<h2 id="sample-use-case">Sample use case</h2>
<p>An API developer wants to expose their backend using mutual SSL through API Publisher where the server validates the identity of the client so that both parties trust each other. To establish a  secure connection with the backend service, API Manager needs to have the public key of the backend service in the truststore. Then configure API Manager to enable dynamic SSL profiles for HTTPS transport Sender and enable dynamic loading of the configuration. Then the developer would go to the API publisher and create and publish an API by entering API name, version, context, and at least one resource, and give the endpoint address to establish a secure connection with. </p>
<h2 id="supported-versions">Supported versions</h2>
<p>All</p>
<h2 id="pre-requisites">Pre-requisites</h2>
<h2 id="development-guidelines">Development guidelines</h2>
<p>Start wso2am-2.6.0 distribution by executing [APIM_HOME]/bin/wso2server.sh or [APIM_HOME]/bin/wso2server.bat 
Then user will need to login to API publisher as API creator. Once logged in, the user will need to enter the mandatory fields such API name, version, context, visibilty and one resource to create one basic API. Once entered these fields user will be able to save the details(Click on 'SAVE' button)
So that user should be able to see newly created API with status as 'CREATED'. Then user will need to update the endpoint URLs which the secure connection should be established with. Complete the rest of the flow up to publish the API. </p>
<h2 id="sample-configuration">Sample Configuration</h2>
<ol>
<li>Generate keys for the backend.
<code>keytool -keystore backend.jks -genkey -alias backend</code></li>
<li>Export the certificate from the keystore. 
<code>keytool -export -keystore backend.jks -alias backend -file backend.crt</code></li>
<li>Import the generated backend certificate to the API Manager truststore file.
<code>keytool -import -file backend.crt -alias backend -keystore &lt;APIM_HOME&gt;/repository/resources/security/client-truststore.jks</code></li>
<li>Export the public certificate from API Manager's keystore. Use <APIM_HOME>/repository/resources/security/wso2carbon.jks file which is the default keystore of WSO2 API Manager.
<code>keytool -export -keystore wso2carbon.jks -alias wso2carbon -file wso2PubCert.cert</code></li>
<li>Import the generated certificate to your backend truststore.
<code>keytool -import -file wso2PubCert.crt -alias wso2carbon -keystore backend-truststore.jks</code></li>
<li>To configure APIM for Dynamic SSL Profiles for HTTPS transport Sender, you need to create a new XML file <APIM_HOME>/repository/deployment/server/multi_ssl_profiles.xml (this path is configurable) and copy the below configuration into it. This will configure client-truststore.jks as Trust Store for all connections to <localhost:port>. </li>
</ol>
<pre><code class="xml">&lt;parameter name=&quot;customSSLProfiles&quot;&gt;
&lt;!-- For SSL Handshake configure only trust store--&gt;
 &lt;profile&gt;
  &lt;servers&gt;localhost:port&lt;/servers&gt;
  &lt;TrustStore&gt;
    &lt;Location&gt;repository/resources/security/client-truststore.jks
    &lt;/Location&gt;
    &lt;Type&gt;JKS&lt;/Type&gt;
    &lt;Password&gt;wso2carbon&lt;/Password&gt;
  &lt;/TrustStore&gt;
&lt;/profile&gt;
&lt;!-- For Mutual SSL Handshake configure both trust store and key store--&gt; 
 &lt;profile&gt;
     &lt;servers&gt;10.100.5.130:9444&lt;/servers&gt;
     &lt;TrustStore&gt;
     &lt;Location&gt;repository/resources/security/client-truststore.jks
     &lt;/Location&gt;
     &lt;Type&gt;JKS&lt;/Type&gt;
    &lt;Password&gt;wso2carbon&lt;/Password&gt;
     &lt;/TrustStore&gt; 
     &lt;KeyStore&gt;
         &lt;Location&gt;repository/resources/security/wso2carbon.jks&lt;/Location&gt;
         &lt;Type&gt;JKS&lt;/Type&gt;
         &lt;Password&gt;xxxxxx&lt;/Password&gt;
         &lt;KeyPassword&gt;xxxxxx&lt;/KeyPassword&gt;
     &lt;/KeyStore&gt;
&lt;/profile&gt;
&lt;/parameter&gt;
</code></pre>

<p>To enable dynamic loading of this configuration, add below configurations to the Transport Sender configuration (PassThroughHttpSSLSender) of API Manager (<APIM_HOME>/repository/conf/axis2.xml). Set above file’s path as the filePath parameter.</p>
<pre><code class="xml">&lt;parameter name=&quot;dynamicSSLProfilesConfig&quot;&gt; 
    &lt;filePath&gt;repository/deployment/server/multi_ssl_profiles.xml&lt;/filePath&gt;
    &lt;fileReadInterval&gt;3600000&lt;/fileReadInterval&gt; 
&lt;/parameter&gt;
&lt;parameter name=&quot;HostnameVerifier&quot;&gt;AllowAll&lt;/parameter&gt;
</code></pre>

<p>Now both the backend service and API Manager is configured to use default key stores and API Manager is configured to load dynamic SSL profiles. Restart API Manager.</p>
<h2 id="deployment-guidelines">Deployment guidelines</h2>
<p>API Manager 2.6.0 deployment required. Import the generated backend certificate to the API Manager truststore file. Export API Manager's public certificate to backend truststore.</p>
<h2 id="rest-api-if-available">REST API (if available)</h2>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            2018 WSO2, Inc.
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../../../assets/javascripts/application.9e1f3b71.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../../../../.."}})</script>
      
    
    
      
    
  </body>
</html>